# =========================================
# SSH Config File - Enhanced Security & Performance
# =========================================

# -------------------------
# Default SSH Options (Global)
# -------------------------
Host *
    # ===== SECURITY SETTINGS =====
    StrictHostKeyChecking ask # Verify host keys against known_hosts
    HashKnownHosts yes # Hash hostnames in known_hosts for privacy
    UserKnownHostsFile ~/.ssh/known_hosts # Location of known hosts file
    AddKeysToAgent yes # Automatically add keys to SSH agent
    KexAlgorithms sntrup761x25519-sha512@openssh.com,curve25519-sha256 # Use strong key exchange algorithms

    # ===== AUTHENTICATION SETTINGS =====
    PreferredAuthentications publickey,password # Try YubiKey/pubkey first, then password
    PubkeyAuthentication yes # Enable public key authentication
    PasswordAuthentication yes # Enable password authentication as fallback
    KbdInteractiveAuthentication no # Disable keyboard-interactive auth
    GSSAPIAuthentication no # Disable GSSAPI authentication

    # ===== CONNECTION OPTIMIZATION =====
    ForwardAgent yes # Enable agent forwarding (for security key)
    ForwardX11 no # Disable X11 forwarding (for security)
    ForwardX11Trusted no # Don't trust X11 forwarding

    # ===== PERFORMANCE SETTINGS =====
    Compression yes # Enable compression for slower connections
    TCPKeepAlive yes # Keep TCP connection alive
    ServerAliveInterval 30 # Keep the connection alive by sending a packet every 30 seconds
    ServerAliveCountMax 3 # If no response, allow up to 3 intervals before disconnecting
    ControlMaster auto # Enable SSH multiplexing for faster repeated connections
    ControlPath ~/.ssh/sockets/%C # Define where to store SSH control sockets (for multiplexing)
    ControlPersist 10m # Keep SSH control sockets active for 10 minutes after last use

    # ===== PORT FORWARDING SAFETY =====
    ExitOnForwardFailure yes # Fail the connection if a requested forward cannot be established
    StreamLocalBindUnlink yes # Auto-unlink existing UNIX socket before binding (avoids stale sockets)

    # ===== LOGGING & DEBUGGING =====
    LogLevel INFO # Suppress SSH output to avoid cluttering the terminal

# Source local config
Include ~/.ssh/config_local

# -------------------------
# Git Hosts Configuration
# -------------------------
Host github.com
    HostName github.com
    User git
    #_desc "GitHub Auth"

Host gitlab.com
    HostName gitlab.com
    User git
    #_desc "Gitlab Auth"

Host bitbucket.org
    HostName bitbucket.org
    User git
    #_desc "Bitbucket Auth"

# -------------------------
# Add Additional Hosts to custom_hosts
# -------------------------

# Example:
# Host myserver
#     HostName myserver.example.com
#     User myusername
#     IdentityFile ~/.ssh/id_rsa_myserver
#     Port 22
#     #_desc "myserver description"
